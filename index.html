<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¡œê°€ì˜¨ SCM Â· Rawgaon</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    /* Slack ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
    --slack-purple: #4A154B;
    --slack-purple-hover: #3b1240;
    --slack-purple-active: rgba(255,255,255,0.16);
    --slack-text-on-purple: #E8DEF8;
    --slack-text-dim: rgba(255,255,255,0.56);
    --slack-divider: rgba(255,255,255,0.13);

    --bg-main: #FFFFFF;
    --bg-body: #F8F8F8;
    --text-primary: #1D1C1D;
    --text-secondary: #616061;
    --text-dim: #868686;
    --border: #E8E8E8;
    --border-focus: #4A154B;

    --green: #2BAC76;
    --yellow: #ECB22E;
    --red: #E01E5A;
    --blue: #1264A3;
    --blue-light: #D9EAFF;

    --success-bg: #DAFFD8;
    --warning-bg: #FFF4CC;
    --danger-bg: #FFE8EF;

    --sidebar-width: 260px;
    --topbar-h: 49px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Lato', 'Noto Sans KR', sans-serif;
    background: var(--bg-body);
    color: var(--text-primary);
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì‚¬ì´ë“œë°” (Slack ìŠ¤íƒ€ì¼)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .sidebar {
    width: var(--sidebar-width);
    background: var(--slack-purple);
    display: flex;
    flex-direction: column;
    height: 100vh;
    flex-shrink: 0;
    user-select: none;
  }

  /* ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í—¤ë” */
  .workspace-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    height: var(--topbar-h);
    border-bottom: 1px solid var(--slack-divider);
    cursor: pointer;
    transition: background 0.1s;
  }
  .workspace-header:hover { background: var(--slack-purple-hover); }

  .workspace-name {
    font-size: 15px;
    font-weight: 900;
    color: #FFFFFF;
    letter-spacing: -0.3px;
  }

  .workspace-chevron {
    width: 20px; height: 20px;
    background: #FFFFFF;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .workspace-chevron span { font-size: 10px; color: var(--slack-purple); font-weight: 900; }

  /* ì‚¬ì´ë“œë°” ìƒíƒœ ì¸ë””ì¼€ì´í„° */
  .sidebar-status {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-bottom: 1px solid var(--slack-divider);
  }

  .status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--green);
    flex-shrink: 0;
  }

  .status-text {
    font-size: 12px;
    color: var(--slack-text-dim);
  }

  /* ì‚¬ì´ë“œë°” ê²€ìƒ‰ */
  .sidebar-search {
    padding: 8px 12px;
    border-bottom: 1px solid var(--slack-divider);
  }

  .search-input-wrap {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 6px;
    padding: 5px 10px;
    cursor: text;
    transition: all 0.15s;
  }
  .search-input-wrap:hover { background: rgba(255,255,255,0.15); }

  .search-icon { font-size: 12px; color: var(--slack-text-dim); }

  .search-input-fake {
    font-size: 13px;
    color: var(--slack-text-dim);
  }

  /* ë„¤ë¹„ê²Œì´ì…˜ */
  .nav-body {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
  }

  .nav-body::-webkit-scrollbar { width: 4px; }
  .nav-body::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }

  .nav-section-label {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 8px 16px 4px;
    font-size: 13px;
    font-weight: 700;
    color: var(--slack-text-dim);
    cursor: pointer;
    transition: color 0.1s;
  }
  .nav-section-label:hover { color: #FFFFFF; }

  .nav-section-label .caret { font-size: 10px; }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 16px;
    cursor: pointer;
    color: var(--slack-text-on-purple);
    font-size: 14px;
    font-weight: 400;
    transition: all 0.1s;
    border-radius: 6px;
    margin: 0 8px;
    position: relative;
  }

  .nav-item:hover { background: rgba(255,255,255,0.09); color: #FFFFFF; }
  .nav-item.active {
    background: var(--slack-purple-active);
    color: #FFFFFF;
    font-weight: 700;
  }

  .nav-item .hash {
    font-size: 16px;
    font-weight: 400;
    opacity: 0.7;
    width: 16px;
    flex-shrink: 0;
    text-align: center;
  }

  .nav-item.active .hash { opacity: 1; }

  .nav-item .unread-dot {
    width: 8px; height: 8px;
    background: #FFFFFF;
    border-radius: 50%;
    margin-left: auto;
  }

  /* ìœ ì € ì˜ì—­ */
  .sidebar-user {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    border-top: 1px solid var(--slack-divider);
    cursor: pointer;
    transition: background 0.1s;
  }
  .sidebar-user:hover { background: rgba(255,255,255,0.07); }

  .user-avatar {
    width: 28px; height: 28px;
    background: var(--green);
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    color: white;
    font-size: 11px;
    font-weight: 900;
    flex-shrink: 0;
    position: relative;
  }

  .user-avatar::after {
    content: '';
    position: absolute;
    bottom: -2px; right: -2px;
    width: 9px; height: 9px;
    background: var(--green);
    border-radius: 50%;
    border: 2px solid var(--slack-purple);
  }

  .user-name { font-size: 14px; font-weight: 700; color: #FFFFFF; }
  .user-role { font-size: 11px; color: var(--slack-text-dim); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ë©”ì¸ ë ˆì´ì•„ì›ƒ
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .main {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* ìƒë‹¨ ì±„ë„ í—¤ë” */
  .channel-header {
    height: var(--topbar-h);
    background: var(--bg-main);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    flex-shrink: 0;
  }

  .channel-header-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .channel-hash {
    font-size: 20px;
    color: var(--text-secondary);
    font-weight: 300;
  }

  .channel-title {
    font-size: 15px;
    font-weight: 900;
    color: var(--text-primary);
  }

  .channel-divider {
    width: 1px;
    height: 20px;
    background: var(--border);
    margin: 0 8px;
  }

  .channel-desc {
    font-size: 13px;
    color: var(--text-secondary);
  }

  .channel-header-right {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* ìƒë‹¨ ê²€ìƒ‰ */
  .topbar-search {
    display: flex;
    align-items: center;
    gap: 6px;
    background: var(--bg-body);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 5px 12px;
    width: 280px;
    cursor: text;
  }

  .topbar-search span { font-size: 13px; color: var(--text-dim); }

  /* ë²„íŠ¼ */
  .btn {
    padding: 6px 14px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: all 0.12s;
    font-family: inherit;
  }

  .btn-primary {
    background: var(--green);
    color: white;
  }
  .btn-primary:hover { background: #229a66; }

  .btn-outline {
    background: white;
    color: var(--text-primary);
    border: 1px solid var(--border);
  }
  .btn-outline:hover { background: var(--bg-body); }

  .btn-slack {
    background: var(--slack-purple);
    color: white;
  }
  .btn-slack:hover { background: var(--slack-purple-hover); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì½˜í…ì¸  ì˜ì—­
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .content-area {
    flex: 1;
    overflow-y: auto;
    padding: 24px 28px;
    background: var(--bg-body);
  }

  .content-area::-webkit-scrollbar { width: 6px; }
  .content-area::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* í™”ë©´ ì „í™˜ */
  .screen { display: none; }
  .screen.active { display: block; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     KPI ì¹´ë“œ (Slack ìŠ¤íƒ€ì¼)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .kpi-card {
    background: var(--bg-main);
    border-radius: 8px;
    padding: 16px 18px;
    border: 1px solid var(--border);
    border-left: 4px solid;
    transition: box-shadow 0.15s;
  }
  .kpi-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }

  .kpi-card.blue { border-left-color: var(--blue); }
  .kpi-card.green { border-left-color: var(--green); }
  .kpi-card.yellow { border-left-color: var(--yellow); }
  .kpi-card.red { border-left-color: var(--red); }

  .kpi-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 700;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .kpi-value {
    font-size: 24px;
    font-weight: 900;
    color: var(--text-primary);
    letter-spacing: -0.5px;
  }
  .kpi-unit { font-size: 13px; font-weight: 400; color: var(--text-secondary); margin-left: 3px; }

  .kpi-sub {
    margin-top: 6px;
    font-size: 12px;
    color: var(--text-dim);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì¹´ë“œ (Slack ë©”ì‹œì§€ ëŠë‚Œ)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .card {
    background: var(--bg-main);
    border-radius: 8px;
    border: 1px solid var(--border);
    overflow: hidden;
    margin-bottom: 12px;
    transition: box-shadow 0.15s;
  }
  .card:hover { box-shadow: 0 1px 6px rgba(0,0,0,0.07); }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 18px;
    border-bottom: 1px solid var(--border);
  }

  .card-title-wrap { display: flex; align-items: center; gap: 8px; }
  .card-hash { font-size: 14px; color: var(--text-secondary); }
  .card-title { font-size: 14px; font-weight: 900; color: var(--text-primary); }
  .card-body { padding: 18px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì°¨íŠ¸ ê·¸ë¦¬ë“œ
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .charts-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
  }

  /* ì±„ë„ ë§‰ëŒ€ */
  .channel-bars { display: flex; flex-direction: column; gap: 10px; }
  .channel-bar-item { display: flex; align-items: center; gap: 10px; }
  .channel-name { font-size: 13px; color: var(--text-primary); font-weight: 700; width: 66px; flex-shrink: 0; }
  .bar-track { flex: 1; height: 6px; background: var(--bg-body); border-radius: 3px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 3px; transition: width 0.8s ease; }
  .bar-value { font-size: 12px; font-weight: 700; color: var(--text-secondary); width: 40px; text-align: right; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     í…Œì´ë¸” (Slack ìŠ¤íƒ€ì¼)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .sl-table { width: 100%; border-collapse: collapse; }

  .sl-table th {
    font-size: 11px;
    font-weight: 900;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    padding: 10px 16px;
    text-align: left;
    background: var(--bg-body);
    border-bottom: 2px solid var(--border);
    white-space: nowrap;
  }

  .sl-table td {
    padding: 11px 16px;
    font-size: 13px;
    color: var(--text-primary);
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }

  .sl-table tr:last-child td { border-bottom: none; }
  .sl-table tr:hover td { background: #FAFAFA; }

  /* ë°°ì§€ */
  .badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 9px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 700;
  }

  .badge-good { background: var(--success-bg); color: #1a7c4b; }
  .badge-warning { background: var(--warning-bg); color: #8a6000; }
  .badge-danger { background: var(--danger-bg); color: #c0143c; }

  /* ì±„ë„ íƒœê·¸ */
  .ch-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 700;
  }
  .ch-sk { background: #FFF1CC; color: #8a6000; }
  .ch-coupang { background: #FFE8EF; color: #9b1035; }
  .ch-naver { background: #DAFFD8; color: #1a7c4b; }
  .ch-kakao { background: #FFF9CC; color: #7a5c00; }
  .ch-rethink { background: #EDE8FF; color: #4a2fa0; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     í•„í„° ë°”
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .filter-bar {
    background: var(--bg-main);
    border-radius: 8px;
    border: 1px solid var(--border);
    padding: 14px 18px;
    margin-bottom: 14px;
    display: flex;
    gap: 12px;
    align-items: flex-end;
    flex-wrap: wrap;
  }

  .filter-group { display: flex; flex-direction: column; gap: 4px; }
  .filter-label { font-size: 11px; color: var(--text-secondary); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }

  select, input[type="date"] {
    padding: 7px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 13px;
    color: var(--text-primary);
    background: white;
    outline: none;
    font-family: inherit;
    transition: border-color 0.15s;
  }
  select:focus, input:focus { border-color: var(--slack-purple); box-shadow: 0 0 0 2px rgba(74,21,75,0.12); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ë¡œë”©
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 48px;
    color: var(--text-dim);
    font-size: 13px;
    gap: 8px;
  }

  .spinner {
    width: 18px; height: 18px;
    border: 2px solid var(--border);
    border-top-color: var(--slack-purple);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì„¤ì •
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

  .settings-card {
    background: var(--bg-main);
    border-radius: 8px;
    border: 1px solid var(--border);
    padding: 18px;
  }

  .settings-title {
    font-size: 14px;
    font-weight: 900;
    color: var(--text-primary);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .settings-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 9px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
  }
  .settings-row:last-child { border-bottom: none; }
  .settings-key { color: var(--text-secondary); }
  .settings-val { font-weight: 700; color: var(--text-primary); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì•Œë¦¼ í† ìŠ¤íŠ¸ (Slack ìŠ¤íƒ€ì¼)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #1D1C1D;
    color: white;
    padding: 10px 18px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    opacity: 0;
    transform: translateY(8px);
    transition: all 0.25s;
    z-index: 999;
    max-width: 340px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  }
  .toast.show { opacity: 1; transform: translateY(0); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì„¹ì…˜ ì•ˆë‚´ ë©”ì‹œì§€ (Slack ë©”ì‹œì§€ ìŠ¤íƒ€ì¼)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .slack-notice {
    display: flex;
    gap: 12px;
    padding: 14px 18px;
    background: #F8F8F8;
    border-radius: 8px;
    border-left: 4px solid var(--slack-purple);
    margin-bottom: 16px;
  }

  .notice-icon { font-size: 20px; flex-shrink: 0; }
  .notice-body p { font-size: 13px; color: var(--text-primary); line-height: 1.6; }
  .notice-body strong { font-weight: 900; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ë°˜ì‘í˜•
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  @media (max-width: 1200px) {
    .kpi-grid { grid-template-columns: repeat(2, 1fr); }
    .charts-grid { grid-template-columns: 1fr; }
  }

  /* ë°ì´í„° ì…ë ¥ ë²„íŠ¼ ë¦¬ìŠ¤íŠ¸ */
  .action-list { display: flex; flex-direction: column; gap: 10px; margin-top: 4px; }

  .action-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: white;
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    text-align: left;
    font-family: inherit;
    transition: all 0.12s;
    text-decoration: none;
  }
  .action-btn:hover {
    border-color: var(--slack-purple);
    background: #f9f3f9;
    color: var(--slack-purple);
  }
  .action-btn .ab-icon { font-size: 20px; }
  .action-btn .ab-desc { font-size: 12px; color: var(--text-secondary); font-weight: 400; margin-top: 2px; }

  /* ì†ìµ ì±„ë„ ìƒ‰ìƒ */
  .profit-positive { color: var(--green); font-weight: 900; }
  .profit-negative { color: var(--red); font-weight: 900; }
</style>
<!-- MSAL (Microsoft Authentication Library) -->
<script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Microsoft ë¡œê·¸ì¸ í™”ë©´
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen" style="position:fixed;top:0;left:0;right:0;bottom:0;
  background:#0f172a;display:flex;align-items:center;justify-content:center;z-index:9999;">
  <div style="text-align:center;color:white;">
    <div style="font-size:13px;color:rgba(255,255,255,0.4);letter-spacing:3px;margin-bottom:4px;">RAWGAON CORP.</div>
    <div style="font-size:36px;font-weight:700;margin:8px 0;letter-spacing:2px;">SCM</div>
    <div style="font-size:13px;color:rgba(255,255,255,0.4);margin-bottom:40px;">Sales Channel Management</div>
    <button onclick="msLogin()" style="background:#1a56db;color:white;border:none;
      padding:14px 32px;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;
      display:inline-flex;align-items:center;gap:10px;transition:background 0.2s;"
      onmouseover="this.style.background='#1e429f'" onmouseout="this.style.background='#1a56db'">
      <svg width="20" height="20" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
        <rect x="1" y="1" width="9" height="9" fill="#f25022"/>
        <rect x="11" y="1" width="9" height="9" fill="#7fba00"/>
        <rect x="1" y="11" width="9" height="9" fill="#00a4ef"/>
        <rect x="11" y="11" width="9" height="9" fill="#ffb900"/>
      </svg>
      Microsoft ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
    </button>
    <div style="margin-top:14px;font-size:12px;color:rgba(255,255,255,0.3);">@rawgaon.com ê³„ì •ë§Œ í—ˆìš©</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì‚¬ì´ë“œë°”
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sidebar">

  <!-- ì›Œí¬ìŠ¤í˜ì´ìŠ¤ -->
  <div class="workspace-header">
    <div class="workspace-name">ğŸ¢ Rawgaon SCM</div>
    <div class="workspace-chevron"><span>â–¾</span></div>
  </div>

  <!-- ìƒíƒœ -->
  <div class="sidebar-status">
    <div class="status-dot"></div>
    <div class="status-text">ì˜¨ë¼ì¸ Â· SCM v1.0 (GAS)</div>
  </div>

  <!-- ê²€ìƒ‰ -->
  <div class="sidebar-search">
    <div class="search-input-wrap">
      <span class="search-icon">ğŸ”</span>
      <span class="search-input-fake">Rawgaon SCM ê²€ìƒ‰</span>
    </div>
  </div>

  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <div class="nav-body">
    <div class="nav-section-label">
      <span class="caret">â–¾</span> ì±„ë„
    </div>

    <div class="nav-item active" onclick="showScreen('dashboard', this)">
      <span class="hash">#</span> ëŒ€ì‹œë³´ë“œ
    </div>
    <div class="nav-item" onclick="showScreen('sales', this)">
      <span class="hash">#</span> ë§¤ì¶œ-ì¡°íšŒ
    </div>
    <div class="nav-item" onclick="showScreen('stock', this)">
      <span class="hash">#</span> ì¬ê³ -í˜„í™©
    </div>
    <div class="nav-item" onclick="showScreen('profit', this)">
      <span class="hash">#</span> ì†ìµ-ë¶„ì„
    </div>

    <div class="nav-section-label" style="margin-top:8px;">
      <span class="caret">â–¾</span> ê´€ë¦¬
    </div>

    <div class="nav-item" onclick="showScreen('input', this)">
      <span class="hash">â†‘</span> ë°ì´í„°-ì…ë ¥
    </div>
    <div class="nav-item" onclick="showScreen('master', this)">
      <span class="hash">âš™</span> ë§ˆìŠ¤í„°-ê´€ë¦¬
    </div>
  </div>

  <!-- ìœ ì € -->
  <div class="sidebar-user">
    <div class="user-avatar">ì´ì„ </div>
    <div>
      <div class="user-name">ì´ì„ ìƒ</div>
      <div class="user-role">ì˜ì—…íŒ€</div>
    </div>
  </div>

</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ë©”ì¸ ì˜ì—­
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="main">

  <!-- ì±„ë„ í—¤ë” -->
  <div class="channel-header">
    <div class="channel-header-left">
      <span class="channel-hash">#</span>
      <span class="channel-title" id="pageTitle">ëŒ€ì‹œë³´ë“œ</span>
      <div class="channel-divider"></div>
      <span class="channel-desc" id="pageSubtitle">2026ë…„ 2ì›” ê¸°ì¤€ í˜„í™©</span>
    </div>
    <div class="channel-header-right">
      <div class="topbar-search">
        <span>ğŸ”</span>
        <span>ë°ì´í„° ê²€ìƒ‰...</span>
      </div>
      <button class="btn btn-outline" onclick="loadData()">â†º ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn btn-slack" onclick="openSheet()">ğŸ“Š êµ¬ê¸€ ì‹œíŠ¸</button>
    </div>
  </div>

  <!-- ì½˜í…ì¸  -->
  <div class="content-area">

    <!-- â•â• ëŒ€ì‹œë³´ë“œ â•â• -->
    <div id="screen-dashboard" class="screen active">

      <div class="kpi-grid">
        <div class="kpi-card blue">
          <div class="kpi-label">ì´ë²ˆ ë‹¬ ë§¤ì¶œ</div>
          <div class="kpi-value" id="kpi-sales">â€”<span class="kpi-unit">ì›</span></div>
          <div class="kpi-sub" id="kpi-sales-change">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
        <div class="kpi-card green">
          <div class="kpi-label">ì´ë²ˆ ë‹¬ ì •ì‚°ê¸ˆì•¡</div>
          <div class="kpi-value" id="kpi-settlement">â€”<span class="kpi-unit">ì›</span></div>
          <div class="kpi-sub" id="kpi-settlement-change">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
        <div class="kpi-card yellow">
          <div class="kpi-label">ì´ íŒë§¤ ê±´ìˆ˜</div>
          <div class="kpi-value" id="kpi-orders">â€”<span class="kpi-unit">ê±´</span></div>
          <div class="kpi-sub" id="kpi-orders-change">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
        <div class="kpi-card red">
          <div class="kpi-label">ì¬ê³  ë¶€ì¡± SKU</div>
          <div class="kpi-value" id="kpi-lowstock">â€”<span class="kpi-unit">ê°œ</span></div>
          <div class="kpi-sub">ì•ˆì „ì¬ê³  ì´í•˜ ê¸°ì¤€</div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="card">
          <div class="card-header">
            <div class="card-title-wrap">
              <span class="card-hash">#</span>
              <span class="card-title">ì±„ë„ë³„ ë§¤ì¶œ ë¹„ì¤‘</span>
            </div>
          </div>
          <div class="card-body">
            <div class="channel-bars" id="channelBars">
              <div class="loading"><div class="spinner"></div> ë¡œë”© ì¤‘...</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title-wrap">
              <span class="card-hash">#</span>
              <span class="card-title">ì¬ê³  í˜„í™© ìš”ì•½</span>
            </div>
          </div>
          <div style="overflow-x:auto;">
            <table class="sl-table">
              <thead>
                <tr>
                  <th>SKU</th>
                  <th>ì œí’ˆëª…</th>
                  <th>í˜„ì¬ê³ </th>
                  <th>ìƒíƒœ</th>
                </tr>
              </thead>
              <tbody id="stockSummary">
                <tr><td colspan="4"><div class="loading"><div class="spinner"></div> ë¡œë”© ì¤‘...</div></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• ë§¤ì¶œ ì¡°íšŒ â•â• -->
    <div id="screen-sales" class="screen">
      <div class="filter-bar">
        <div class="filter-group">
          <div class="filter-label">ì‹œì‘ì¼</div>
          <input type="date" id="filterDateFrom" value="2026-01-01">
        </div>
        <div class="filter-group">
          <div class="filter-label">ì¢…ë£Œì¼</div>
          <input type="date" id="filterDateTo" value="2026-02-28">
        </div>
        <div class="filter-group">
          <div class="filter-label">íŒë§¤ì±„ë„</div>
          <select id="filterChannel">
            <option value="">ì „ì²´</option>
            <option>SKìŠ¤í† ì•„</option>
            <option>ì¿ íŒ¡</option>
            <option>ë„¤ì´ë²„</option>
            <option>ì¹´ì¹´ì˜¤</option>
            <option>ë¦¬ì”½í¬</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="loadSalesData()">ğŸ” ì¡°íšŒ</button>
      </div>

      <div class="card">
        <div style="overflow-x:auto;">
          <table class="sl-table">
            <thead>
              <tr>
                <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                <th>ì±„ë„</th>
                <th>ì£¼ë¬¸ì¼</th>
                <th>SKU</th>
                <th>ìˆ˜ëŸ‰</th>
                <th>ì´íŒë§¤ê°€</th>
                <th>ì‹¤ì •ì‚°ê¸ˆì•¡</th>
                <th>ê³µí—Œì´ìµ</th>
              </tr>
            </thead>
            <tbody id="salesTableBody">
              <tr><td colspan="8"><div class="loading">ğŸ” ì¡°íšŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â• ì¬ê³  í˜„í™© â•â• -->
    <div id="screen-stock" class="screen">
      <div class="card">
        <div style="overflow-x:auto;">
          <table class="sl-table">
            <thead>
              <tr>
                <th>ìì‚¬SKU</th>
                <th>ì œí’ˆëª…</th>
                <th>ì¹´í…Œê³ ë¦¬</th>
                <th>ê¸°ì´ˆì¬ê³ </th>
                <th>ì•ˆì „ì¬ê³ </th>
                <th>ë§¤ì…ì›ê°€</th>
                <th>ë³´ê´€ì˜¨ë„</th>
                <th>ìƒíƒœ</th>
              </tr>
            </thead>
            <tbody id="stockTableBody">
              <tr><td colspan="8"><div class="loading"><div class="spinner"></div> ë¡œë”© ì¤‘...</div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â• ì†ìµ ë¶„ì„ â•â• -->
    <div id="screen-profit" class="screen">

      <div class="kpi-grid">
        <div class="kpi-card blue">
          <div class="kpi-label">ì´ ì •ì‚°ê¸ˆì•¡</div>
          <div class="kpi-value" id="profit-settlement">â€”</div>
        </div>
        <div class="kpi-card red">
          <div class="kpi-label">ì´ ì›ê°€</div>
          <div class="kpi-value" id="profit-cost">â€”</div>
        </div>
        <div class="kpi-card green">
          <div class="kpi-label">ì´ ê³µí—Œì´ìµ</div>
          <div class="kpi-value" id="profit-margin">â€”</div>
        </div>
        <div class="kpi-card yellow">
          <div class="kpi-label">ê³µí—Œì´ìµë¥ </div>
          <div class="kpi-value" id="profit-rate">â€”%</div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title-wrap">
            <span class="card-hash">#</span>
            <span class="card-title">ì±„ë„ë³„ ì†ìµ ë¶„ì„</span>
          </div>
        </div>
        <div style="overflow-x:auto;">
          <table class="sl-table">
            <thead>
              <tr>
                <th>ì±„ë„</th>
                <th>íŒë§¤ê±´ìˆ˜</th>
                <th>ì´íŒë§¤ê°€</th>
                <th>ì •ì‚°ê¸ˆì•¡</th>
                <th>ì´ì›ê°€</th>
                <th>ê³µí—Œì´ìµ</th>
                <th>ì´ìµë¥ </th>
              </tr>
            </thead>
            <tbody id="profitTableBody">
              <tr><td colspan="7"><div class="loading"><div class="spinner"></div> ë¡œë”© ì¤‘...</div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â• ë°ì´í„° ì…ë ¥ â•â• -->
    <div id="screen-input" class="screen">
      <div class="slack-notice">
        <span class="notice-icon">ğŸ’¡</span>
        <div class="notice-body">
          <p><strong>ì±„ë„ ì—‘ì…€ íŒŒì¼</strong>ì„ êµ¬ê¸€ ë“œë¼ì´ë¸Œ í•´ë‹¹ ì±„ë„ í´ë”ì— ì—…ë¡œë“œí•˜ë©´, Apps Scriptê°€ <strong>30ë¶„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì²˜ë¦¬</strong>í•´ì„œ íŒë§¤ë°ì´í„° ì‹œíŠ¸ì— ì…ë ¥í•´ì¤˜!</p>
        </div>
      </div>

      <div class="card" style="max-width: 580px;">
        <div class="card-header">
          <div class="card-title-wrap">
            <span class="card-hash">â†‘</span>
            <span class="card-title">ë°ì´í„° ì—…ë¡œë“œ ë°”ë¡œê°€ê¸°</span>
          </div>
        </div>
        <div class="card-body">
          <div class="action-list">
            <button class="action-btn" onclick="openSheet()">
              <span class="ab-icon">ğŸŠ</span>
              <div>
                <div>_ë¡œê°€ì˜¨_SCM_DB ì‹œíŠ¸ ì—´ê¸°</div>
                <div class="ab-desc">íŒë§¤ë°ì´í„° Â· ì œí’ˆë§ˆìŠ¤í„° Â· ì±„ë„ë§¤í•‘ í™•ì¸</div>
              </div>
            </button>
            <button class="action-btn" onclick="window.open('https://drive.google.com')">
              <span class="ab-icon">ğŸ“</span>
              <div>
                <div>êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—´ê¸°</div>
                <div class="ab-desc">ì±„ë„ë³„ í´ë”ì— ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</div>
              </div>
            </button>
          </div>

          <div style="margin-top:16px; padding:12px 14px; background: #f3f0ff; border-radius:8px; border-left: 3px solid var(--slack-purple);">
            <p style="font-size:12px; color: var(--text-secondary); line-height:1.7;">
              <strong style="color:var(--slack-purple);">ğŸ“‚ ì±„ë„ í´ë” êµ¬ì¡°</strong><br>
              _01_SKìŠ¤í† ì•„ / _02_ì¿ íŒ¡ / _03_ë„¤ì´ë²„ / _04_ì¹´ì¹´ì˜¤ / _05_ë¦¬ì”½í¬<br>
              â†’ <strong>ì²˜ë¦¬ì™„ë£Œ íŒŒì¼</strong>ì€ _99_ì²˜ë¦¬ì™„ë£Œ í´ë”ë¡œ ìë™ ì´ë™
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• ë§ˆìŠ¤í„° ê´€ë¦¬ â•â• -->
    <div id="screen-master" class="screen">
      <div class="settings-grid">
        <div class="settings-card">
          <div class="settings-title">ğŸ“‹ êµ¬ê¸€ ì‹œíŠ¸ ë°”ë¡œê°€ê¸°</div>
          <div class="action-list">
            <button class="action-btn" onclick="openSheet()">
              <span class="ab-icon">ğŸ“Š</span>
              <div>
                <div>_ë¡œê°€ì˜¨_SCM_DB</div>
                <div class="ab-desc">ì œí’ˆë§ˆìŠ¤í„° Â· ì±„ë„ë§¤í•‘ í¸ì§‘</div>
              </div>
            </button>
          </div>
        </div>

        <div class="settings-card">
          <div class="settings-title">âš™ï¸ ì‹œìŠ¤í…œ ì •ë³´</div>
          <div class="settings-row">
            <span class="settings-key">ë°ì´í„° ì†ŒìŠ¤</span>
            <span class="settings-val">Google Apps Script</span>
          </div>
          <div class="settings-row">
            <span class="settings-key">ë²„ì „</span>
            <span class="settings-val">v1.0 (2026.02)</span>
          </div>
          <div class="settings-row">
            <span class="settings-key">ì±„ë„ ìˆ˜</span>
            <span class="settings-val">5ê°œ</span>
          </div>
          <div class="settings-row">
            <span class="settings-key">ìë™ ì‹¤í–‰</span>
            <span class="settings-val">30ë¶„ë§ˆë‹¤</span>
          </div>
          <div class="settings-row">
            <span class="settings-key">ì›¹ì•± ìƒíƒœ</span>
            <span class="settings-val" style="color:var(--green);">â— í™œì„±</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ GAS ì›¹ì•± ì—°ê²° â”€â”€
const GAS_URL = "https://script.google.com/macros/s/AKfycbzMXh0amAwmWjK1ta2isjUMaApyT7P-ku8dW0GUn_uJuw4VYM2uEr3oNqccRjsc8YvQ6w/exec";
const SHEET_URL = "https://docs.google.com/spreadsheets/d/1eQ-h00YQal3hi4aZVVq2qkIPFJ5pOkYmZNVruKc8fIo";

// â”€â”€ í™”ë©´ ì „í™˜ â”€â”€
const pageMeta = {
  dashboard: ['ëŒ€ì‹œë³´ë“œ',    '2026ë…„ 2ì›” ê¸°ì¤€ í˜„í™©'],
  sales:     ['ë§¤ì¶œ-ì¡°íšŒ',   'ì±„ë„ë³„ íŒë§¤ ë°ì´í„°'],
  stock:     ['ì¬ê³ -í˜„í™©',   'SKUë³„ ì¬ê³  ë° ì•ˆì „ì¬ê³ '],
  profit:    ['ì†ìµ-ë¶„ì„',   'ì±„ë„ë³„ ê³µí—Œì´ìµ ë¶„ì„'],
  input:     ['ë°ì´í„°-ì…ë ¥', 'Google Drive íŒŒì¼ ì—…ë¡œë“œ'],
  master:    ['ë§ˆìŠ¤í„°-ê´€ë¦¬', 'ì œí’ˆ/ì±„ë„ ê¸°ì¤€ ì •ë³´'],
};

function showScreen(name, navEl) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  navEl.classList.add('active');
  document.getElementById('pageTitle').textContent = pageMeta[name][0];
  document.getElementById('pageSubtitle').textContent = pageMeta[name][1];

  if (name === 'stock') loadStockTable();
  if (name === 'profit') loadProfitData();
}

function openSheet() {
  window.open(SHEET_URL, '_blank');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// â”€â”€ ìˆ«ì í¬ë§· â”€â”€
function fmt(num) {
  if (!num && num !== 0) return '0';
  return Math.round(Number(num)).toLocaleString('ko-KR');
}

// â”€â”€ GAS API í˜¸ì¶œ (SharePoint â†’ Google Apps Script) â”€â”€
async function spFetch(listName) {
  const actionMap = {
    'íŒë§¤ë°ì´í„°': 'sales',
    'ì œí’ˆë§ˆìŠ¤í„°': 'products',
    'ì±„ë„ë§¤í•‘':   'mapping'
  };
  const action = actionMap[listName] || 'sales';
  try {
    const res = await fetch(`${GAS_URL}?action=${action}`);
    if (!res.ok) throw new Error('GAS API ì˜¤ë¥˜');
    const data = await res.json();
    return data.rows.map(row => {
      const obj = {};
      data.headers.forEach((h, i) => { obj[h] = row[i]; });
      return obj;
    });
  } catch (e) {
    console.error('[GAS Error]', listName, e);
    return [];
  }
}

// â”€â”€ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ â”€â”€
async function loadData() {
  showToast('â†º ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘...');

  const [salesData, productData] = await Promise.all([
    spFetch('íŒë§¤ë°ì´í„°'),
    spFetch('ì œí’ˆë§ˆìŠ¤í„°')
  ]);

  // KPI ê³„ì‚°
  const totalSales      = salesData.reduce((s, r) => s + Number(r['ì´íŒë§¤ê°€'] || 0), 0);
  const totalSettlement = salesData.reduce((s, r) => s + Number(r['ì‹¤ì •ì‚°ê¸ˆì•¡'] || 0), 0);
  const totalOrders     = salesData.length;

  document.getElementById('kpi-sales').innerHTML      = `${fmt(totalSales)}<span class="kpi-unit">ì›</span>`;
  document.getElementById('kpi-settlement').innerHTML = `${fmt(totalSettlement)}<span class="kpi-unit">ì›</span>`;
  document.getElementById('kpi-orders').innerHTML     = `${totalOrders}<span class="kpi-unit">ê±´</span>`;
  document.getElementById('kpi-sales-change').textContent      = `ì´ ${totalOrders}ê±´ íŒë§¤`;
  document.getElementById('kpi-settlement-change').textContent = `ì •ì‚°ìœ¨ ${totalSales > 0 ? Math.round(totalSettlement/totalSales*100) : 0}%`;
  document.getElementById('kpi-orders-change').textContent     = '5ê°œ ì±„ë„ í•©ê³„';

  // ì±„ë„ ë¹„ì¤‘ ë§‰ëŒ€
  const channels = ['SKìŠ¤í† ì•„','ì¿ íŒ¡','ë„¤ì´ë²„','ì¹´ì¹´ì˜¤','ë¦¬ì”½í¬'];
  const colors   = ['#ECB22E','#E01E5A','#2BAC76','#F4C542','#8B5CF6'];
  const channelSales = {};
  channels.forEach(c => channelSales[c] = 0);
  salesData.forEach(r => {
    const ch = r['íŒë§¤ì±„ë„'];
    if (ch in channelSales) channelSales[ch] += Number(r['ì´íŒë§¤ê°€'] || 0);
  });

  const maxVal = Math.max(...Object.values(channelSales), 1);
  const barsHtml = channels.map((c, i) => {
    const pct   = Math.round(channelSales[c] / (totalSales || 1) * 100);
    const width = Math.round(channelSales[c] / maxVal * 100);
    return `<div class="channel-bar-item">
      <div class="channel-name">${c}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${width}%;background:${colors[i]};"></div></div>
      <div class="bar-value">${pct}%</div>
    </div>`;
  }).join('');
  document.getElementById('channelBars').innerHTML = barsHtml || '<p style="font-size:13px;color:var(--text-dim);">íŒë§¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';

  // ì¬ê³  ìš”ì•½
  const lowStock = productData.filter(p => Number(p['ê¸°ì´ˆì¬ê³ ']||0) < Number(p['ì•ˆì „ì¬ê³ ']||0)).length;
  document.getElementById('kpi-lowstock').innerHTML = `${lowStock}<span class="kpi-unit">ê°œ</span>`;

  const stockHtml = productData.map(p => {
    const stock = Number(p['ê¸°ì´ˆì¬ê³ '] || 0);
    const safe  = Number(p['ì•ˆì „ì¬ê³ '] || 0);
    const ratio = safe > 0 ? stock / safe : 1;
    const badge = ratio >= 2
      ? '<span class="badge badge-good">ì •ìƒ</span>'
      : ratio >= 1
        ? '<span class="badge badge-warning">ì£¼ì˜</span>'
        : '<span class="badge badge-danger">ë¶€ì¡±</span>';
    return `<tr>
      <td><strong>${p['ìì‚¬SKU'] || p['Title'] || '-'}</strong></td>
      <td>${p['ì œí’ˆëª…'] || '-'}</td>
      <td>${fmt(stock)}</td>
      <td>${badge}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="4" style="text-align:center;padding:24px;color:var(--text-dim);">ë°ì´í„° ì—†ìŒ</td></tr>';
  document.getElementById('stockSummary').innerHTML = stockHtml;

  showToast('âœ… ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ!');
}

// â”€â”€ ë§¤ì¶œ ì¡°íšŒ â”€â”€
async function loadSalesData() {
  document.getElementById('salesTableBody').innerHTML = '<tr><td colspan="8"><div class="loading"><div class="spinner"></div> ì¡°íšŒ ì¤‘...</div></td></tr>';

  const from = document.getElementById('filterDateFrom').value;
  const to   = document.getElementById('filterDateTo').value;
  const ch   = document.getElementById('filterChannel').value;

  let data = await spFetch('íŒë§¤ë°ì´í„°');

  // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°
  if (from) data = data.filter(r => r['ì£¼ë¬¸ì¼'] && r['ì£¼ë¬¸ì¼'] >= from);
  if (to)   data = data.filter(r => r['ì£¼ë¬¸ì¼'] && r['ì£¼ë¬¸ì¼'] <= to + 'T23:59:59');
  if (ch)   data = data.filter(r => r['íŒë§¤ì±„ë„'] === ch);

  const tagMap = {
    'SKìŠ¤í† ì•„': 'ch-sk',
    'ì¿ íŒ¡':     'ch-coupang',
    'ë„¤ì´ë²„':   'ch-naver',
    'ì¹´ì¹´ì˜¤':   'ch-kakao',
    'ë¦¬ì”½í¬':   'ch-rethink'
  };

  const html = data.map(r => {
    const profit = Number(r['ì‹¤ì •ì‚°ê¸ˆì•¡']||0) - Number(r['ì´ì›ê°€']||0);
    const date   = r['ì£¼ë¬¸ì¼'] ? String(r['ì£¼ë¬¸ì¼']).substring(0,10) : '-';
    const pClass = profit >= 0 ? 'profit-positive' : 'profit-negative';
    return `<tr>
      <td>${r['ì£¼ë¬¸ë²ˆí˜¸'] || '-'}</td>
      <td><span class="ch-tag ${tagMap[r['íŒë§¤ì±„ë„']] || ''}">${r['íŒë§¤ì±„ë„'] || '-'}</span></td>
      <td>${date}</td>
      <td>${r['ìì‚¬SKU'] || '-'}</td>
      <td>${fmt(r['íŒë§¤ìˆ˜ëŸ‰'])}</td>
      <td>${fmt(r['ì´íŒë§¤ê°€'])}ì›</td>
      <td>${fmt(r['ì‹¤ì •ì‚°ê¸ˆì•¡'])}ì›</td>
      <td class="${pClass}">${fmt(profit)}ì›</td>
    </tr>`;
  }).join('') || '<tr><td colspan="8" style="text-align:center;padding:32px;color:var(--text-dim);">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';

  document.getElementById('salesTableBody').innerHTML = html;
}

// â”€â”€ ì¬ê³  í…Œì´ë¸” â”€â”€
async function loadStockTable() {
  const data = await spFetch('ì œí’ˆë§ˆìŠ¤í„°');
  const html = data.map(p => {
    const stock = Number(p['ê¸°ì´ˆì¬ê³ '] || 0);
    const safe  = Number(p['ì•ˆì „ì¬ê³ '] || 0);
    const ratio = safe > 0 ? stock / safe : 1;
    const badge = ratio >= 2
      ? '<span class="badge badge-good">ì •ìƒ</span>'
      : ratio >= 1
        ? '<span class="badge badge-warning">ì£¼ì˜</span>'
        : '<span class="badge badge-danger">ë¶€ì¡±</span>';
    return `<tr>
      <td><strong>${p['ìì‚¬SKU'] || p['Title'] || '-'}</strong></td>
      <td>${p['ì œí’ˆëª…'] || '-'}</td>
      <td>${p['ì¹´í…Œê³ ë¦¬'] || '-'}</td>
      <td>${fmt(stock)}</td>
      <td>${fmt(safe)}</td>
      <td>${fmt(p['ë§¤ì…ì›ê°€'])}ì›</td>
      <td>${p['ë³´ê´€ì˜¨ë„'] || '-'}</td>
      <td>${badge}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="8" style="text-align:center;padding:32px;color:var(--text-dim);">ë°ì´í„° ì—†ìŒ</td></tr>';
  document.getElementById('stockTableBody').innerHTML = html;
}

// â”€â”€ ì†ìµ ë¶„ì„ â”€â”€
async function loadProfitData() {
  const data = await spFetch('íŒë§¤ë°ì´í„°');
  const channels = ['SKìŠ¤í† ì•„','ì¿ íŒ¡','ë„¤ì´ë²„','ì¹´ì¹´ì˜¤','ë¦¬ì”½í¬'];
  const stats = {};
  channels.forEach(c => stats[c] = { count:0, sales:0, settlement:0, cost:0 });

  data.forEach(r => {
    const c = r['íŒë§¤ì±„ë„'];
    if (stats[c]) {
      stats[c].count++;
      stats[c].sales      += Number(r['ì´íŒë§¤ê°€']    || 0);
      stats[c].settlement += Number(r['ì‹¤ì •ì‚°ê¸ˆì•¡'] || 0);
      stats[c].cost       += Number(r['ì´ì›ê°€']      || 0);
    }
  });

  const totalSettlement = Object.values(stats).reduce((s, v) => s + v.settlement, 0);
  const totalCost       = Object.values(stats).reduce((s, v) => s + v.cost, 0);
  const totalMargin     = totalSettlement - totalCost;
  const rate            = totalSettlement > 0 ? Math.round(totalMargin / totalSettlement * 100) : 0;

  document.getElementById('profit-settlement').innerHTML = `${fmt(totalSettlement)}<span class="kpi-unit">ì›</span>`;
  document.getElementById('profit-cost').innerHTML       = `${fmt(totalCost)}<span class="kpi-unit">ì›</span>`;
  document.getElementById('profit-margin').innerHTML     = `${fmt(totalMargin)}<span class="kpi-unit">ì›</span>`;
  document.getElementById('profit-rate').textContent     = `${rate}%`;

  const tagMap = { 'SKìŠ¤í† ì•„':'ch-sk', 'ì¿ íŒ¡':'ch-coupang', 'ë„¤ì´ë²„':'ch-naver', 'ì¹´ì¹´ì˜¤':'ch-kakao', 'ë¦¬ì”½í¬':'ch-rethink' };

  const html = channels.map(c => {
    const s          = stats[c];
    const margin     = s.settlement - s.cost;
    const marginRate = s.settlement > 0 ? Math.round(margin / s.settlement * 100) : 0;
    const pClass     = margin >= 0 ? 'profit-positive' : 'profit-negative';
    return `<tr>
      <td><span class="ch-tag ${tagMap[c]}">${c}</span></td>
      <td>${s.count}ê±´</td>
      <td>${fmt(s.sales)}ì›</td>
      <td>${fmt(s.settlement)}ì›</td>
      <td>${fmt(s.cost)}ì›</td>
      <td class="${pClass}">${fmt(margin)}ì›</td>
      <td>${marginRate}%</td>
    </tr>`;
  }).join('');
  document.getElementById('profitTableBody').innerHTML = html;
}

// â”€â”€ MSAL ì„¤ì • (Azure AD ì•± ë“±ë¡ í›„ ë°œê¸‰ë°›ì€ ID ì…ë ¥) â”€â”€
const msalConfig = {
  auth: {
    clientId: "4b156abf-89fa-472b-9002-5ea0e7440dd4",
    authority: "https://login.microsoftonline.com/f8661e8d-9200-42e2-8073-d2b47a5dee93",
    redirectUri: "https://www.rawgaon.co.kr"
  },
  cache: { cacheLocation: "sessionStorage" }
};
const msalInstance = new msal.PublicClientApplication(msalConfig);

async function msLogin() {
  try {
    const r = await msalInstance.loginPopup({ scopes: ["User.Read"] });
    if (!r.account.username.endsWith("@rawgaon.com")) {
      alert("rawgaon.com ê³„ì •ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      await msalInstance.logoutPopup();
      return;
    }
    document.getElementById("loginScreen").style.display = "none";
    const nameEl = document.querySelector(".user-name");
    if (nameEl) nameEl.textContent = r.account.name || r.account.username;
    loadData();
  } catch (e) {
    console.error('MS ë¡œê·¸ìˆ ì˜¤ë¥šr, e);
    alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
  }
}

// â”€â”€ ì´ˆê¸° ë¡œë“œ: ì´ë¯¸ ë¡œê·¸ì¸ëœ ê³„ì • í™•ì¸ â”€â”€
window.addEventListener("load", async () => {
  try {
    await msalInstance.initialize();
    const accounts = msalInstance.getAllAccounts();
    if (accounts.length > 0 && accounts[0].username.endsWith("@rawgaon.com")) {
      document.getElementById("loginScreen").style.display = "none";
      const nameEl = document.querySelector(".user-name");
      if (nameEl) nameEl.textContent = accounts[0].name || accounts[0].username;
      loadData();
    }
    // ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš°: loginScreenì´ í‘œì‹œëœ ì±„ë¡œ ëŒ€ê¸°
  } catch (e) {
    console.warn("MSAL ì´ˆê¸°í™” ì˜¤ë¥š:", e);
  }
});
</script>
</body>
</html>
